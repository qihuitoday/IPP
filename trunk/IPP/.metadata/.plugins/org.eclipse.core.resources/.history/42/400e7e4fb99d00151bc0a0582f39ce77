/*
***************************
*  17k login  javascript  *
*  dependent 17k.js		  *
*  version:1.0            *
*  coder:BennyTian        *
*  date:2011/04/18        *
***************************
*/

if (!window.K17) {
	window.K17 = {};
	window.K17.login = {};
} else if (!window.K17.login) {
	window.K17.login = {};
}
window._ = window.K17;

var loginCallBack = "";
K17.login.form = function(callback){
	K17.dialog("登录","url:get?/inc/fragment/0/2400.html","300px","auto","floatLogin");
	loginCallBack = callback;
};
K17.login.submit = function(){
 	var userName = $("#userName").val();
	var password = $("#password").val();
	if(K17.isEmpty(userName)){
		alert("请输入用户名");
		return false;
	}
	if(K17.isEmpty(password)){
		alert("请输入密码");
		return false;
	}
 	var url="http://passport.17k.com/login.action";
 	var params = {"userName":userName,"password":password};
 	K17.getJSON(url,params,"K17.login.callback");
};

K17.login.callback = function(json){
	if (json.msg == 0){
		if(!K17.isEmpty(loginCallBack)){
			if(loginCallBack.lastIndexOf(";",loginCallBack.length-1)!=-1){
				loginCallBack.substring(0, loginCallBack.length-1);
			}
			var callbacks = loginCallBack.split(";");
			for(var i=0;i<callbacks.length;i++){
				//eval("("+callbacks[i]+")");
				setTimeout(callbacks[i],i*10+100);
			}
		}
		K17.dialog.closebox();
	}else if (json.msg == 2){
		alert("帐号或密码错误！");
	}
};


//chapter需要登陆
K17.login.submit.news = function(){
 	var userName = $("#userName").val();
	var password = $("#password").val();
	var isAutoLogin =  $("input[name=isAutoLogin]").attr("checked");
	if(K17.isEmpty(userName)){
		alert("请输入用户名");
		return false;
	}
	if(K17.isEmpty(password)){
		alert("请输入密码");
		return false;
	}
 	var url="http://passport.17k.com/loginPlug.action";
 	//var url="http://passport.17k.com/login.action";
 	var params = {"userName":userName,"password":password,"isAutoLogin":isAutoLogin,"r":Math.random()};
 	K17.getJSON(url,params,"K17.login.callback.news");
};

//chapter需要登陆回调函数
K17.login.callback.news = function(json){
	if (json.result == true){
		if(!K17.isEmpty(loginCallBack)){
			if(loginCallBack.lastIndexOf(";",loginCallBack.length-1)!=-1){
				loginCallBack.substring(0, loginCallBack.length-1);
			}
			var callbacks = loginCallBack.split(";");
			for(var i=0;i<callbacks.length;i++){
				//eval("("+callbacks[i]+")");
				setTimeout(callbacks[i],i*10+100);
			}
		}
		K17.dialog.closebox();
	}else if (json.result == false){
		alert(json.errorMessage);
	}
};
